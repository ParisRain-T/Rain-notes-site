---
title: P1 规格（v0）：智能小车（端-边-云）升级要求
draft: false
stage: budding
---

# P1_SPEC_v0（小车升级的“非功能要求”先钉死）

P1 不是“重做一个新项目”，而是复用 P0 的端到云底座（命令/遥测/ACK/可观测/部署），把设备侧升级为小车/移动机器人。

> P0 规格见 [[P0_SPEC_v1]]。P1 的核心是：复用 P0 的协议与平台能力，在此基础上补齐机器人系统必备的安全与时序约束。
> 时序/并发/阻塞规则参考 [[实时规则]]；版本交付的最低通过线参考 [[DoD清单]]。

## 1）P1 的最小闭环（必须）

- 云端下发：速度/转向（或模式）命令
- 车端执行：电机控制
- 必有 ACK：命令成功/失败 + 原因
- 遥测上报：速度/电压/状态/错误码（可视化至少一条曲线）

## 2）安全约束（必须写进 DoD）

这些不是“加分项”，是机器人项目的底线，否则项目不可演示、也不敢在现场跑：

- 急停（E-Stop）：硬件按钮或软件命令都可，但必须可靠（优先硬件）
- 命令超时刹车：超过 `T`（例如 500ms~1s）未收到新速度命令 → 自动停止
- 速度限幅：对 PWM/速度设上限，防止误触发暴冲
- 低电压保护：电池过低 → 降速/停止 + 上报错误码
- 看门狗（可选但推荐）：任务卡死能自动复位，复位原因可上报

## 3）坐标系与里程计约定（建议提前钉死）

你不需要一上来做导航，但要避免“数据没法解释”：

- 单位：速度 m/s，角速度 rad/s，角度 rad（或 deg，但必须统一）
- 方向约定：前进为 +x，左转为 +yaw（或你选另一套，但要在文档写清）
- 时间戳：优先用 `host_ts_ms`（网关加），车端提供 `uptime_ms`（用于对齐与排障）

## 4）命令与遥测（建议最小集合）

### 4.1 命令（云端→车端）

- `SET_VEL`：线速度 `v` + 角速度 `w`（或 `left_pwm/right_pwm`）
- `SET_MODE`：手动/自动（后续扩展）
- `E_STOP`：立即停止并锁定（需要明确解锁机制）

### 4.2 遥测（车端→云端）

- `v_meas`：测得速度
- `v_target`：目标速度（用于看控制效果）
- `battery_mv`
- `err_code` / `state`

## 5）阶段 Gate（建议 8 周拆法）

1. 电机驱动跑通（开环）+ 安全占位（急停/限幅）
2. 云端命令接入 + ACK（先能遥控）
3. 编码器接入 + 速度测量
4. 速度 PID（可量化误差）
5. 遥测完善 + 曲线展示
6. IMU（可选）：先保证数据稳定上报
7. 故障注入（断网/掉电/重启）与恢复
8. 英文 README + demo + 复盘报告

## 6）ROS2/导航（你想碰的方向：先仿真，后上车）

推荐进入顺序（避免一上来被 Nav2/SLAM 吞掉）：

1. ROS2 轻触：把“控制/遥测”先做成 ROS2 node（能 `teleop` + 看 topic/TF）
2. ROS2 系统化：做 bridge（`cmd_vel` ↔ `SET_VEL`；遥测 ↔ odom/diagnostics）
3. 导航仿真：Nav2/SLAM 先在仿真跑通配置与数据流（不要求真车）
4. 真车导航：等 P1 v1.0 稳定后再上激光/视觉硬件（否则会被调参与硬件坑拖死）
