---
title: 新机器 10 分钟复现清单（P0/P1）
draft: false
stage: budding
---

# 新机器 10 分钟复现清单（从“能跑”到“可信交付”）

当你要投递/面试/给同学演示时，最容易翻车的不是代码，而是“别人跑不起来”。  
这份清单的目标是：把 P0/P1 做到 **新机器 10–15 分钟能复现**（不追极限，追稳定可控）。

> 规格以 [[P0_SPEC_v1]] 为准；排障流程参考 [[错误码与故障字典]] 与 [[日志规范]]。

## 1）复现定义（DoD）

一个版本能叫“可复现”，至少满足：

- 一条命令起服务：`docker compose up -d`
- 一条命令跑验收：`make test`（或 `./scripts/run_tests.sh`）
- 设备连上后 5 分钟内能看到：telemetry 入库 + API 查询 + 命令下发/ACK
- README 的 Quickstart 不超过 10 步

## 2）前置条件（写进 README 的第一屏）

### 必装（P0 最小集合）

- Git
- Python 3.11+（或你项目固定版本）
- Docker + Docker Compose
- 串口工具（任意：`screen`/`minicom`/GUI）

### 可选（提高一致性）

- `make` / `just`（统一命令入口）
- Node.js（如果你有前端 dashboard）

## 3）复现步骤（建议固定为 7 步）

### Step 1：clone

- `git clone ...`
- `git checkout <release-tag>`

### Step 2：配置环境变量

- 复制 `.env.example` → `.env`
- 填 3 个关键值（示例）
  - `MQTT_HOST`
  - `POSTGRES_URL`
  - `DEVICE_ID=f411-001`

### Step 3：一键启动云端

- `docker compose up -d`
- 通过 `GET /health` 确认后端可用

### Step 4：烧录固件 + 串口验证

- 烧录固件（用你稳定的工具链：CubeIDE/CMSIS-DAP）
- 先验证“串口能稳定输出帧/日志”（不要先跑网关）

### Step 5：启动网关

- `python -m venv .venv && source .venv/bin/activate`
- `pip install -r requirements.txt`
- 运行网关（串口端口名作为参数）
- 验证：网关能 publish telemetry 到 `devices/{device_id}/telemetry`

### Step 6：跑三类验收脚本

建议至少三项：

1. 串口协议脚本（CMD/ACK 1000 次）
2. MQTT 往返脚本（cmd→ack 成功率与 RTT）
3. API 脚本（health/devices/telemetry/commands）

### Step 7：演示闭环（1 分钟）

- 打开一条曲线（或列表）：看到 telemetry
- `POST /devices/{id}/commands` 下发 `SET_LED`
- 设备执行，ACK 入库可查

## 4）复现失败的“最快定位法”（只按层级）

你不需要猜原因，先回答“断在哪一层”：

1. **MCU 是否在跑？**（串口能否看到稳定输出）
2. **网关是否在跑？**（能否解析帧，publish MQTT）
3. **MQTT 是否通？**（订阅 `devices/#` 能否看到消息）
4. **后端是否通？**（`/health` 是否 200，telemetry 是否入库）
5. **DB 是否通？**（行数增长/查询返回）

对应的“证据”必须可留存：

- 串口原始流（hex 或日志）
- 网关日志（带 `device_id/cmd_id/telemetry_seq`）
- 后端日志 + compose logs

## 5）把复现时间压到 10 分钟的技巧

- 把所有命令收敛到一个入口：`make up/down/test/logs`
- 用 `.env.example` 固定变量名与默认值
- 网关启动参数最少化：端口名 + device_id
- 每个脚本输出 PASS/FAIL + 关键统计（用于截图留证）
