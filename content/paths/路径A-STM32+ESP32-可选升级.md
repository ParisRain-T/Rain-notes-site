---
title: 路径A（可选升级）：STM32 + ESP32 直连 WiFi
draft: false
stage: budding
---

# 路径A（可选）：把网关从 PC/树莓派替换成 ESP32

你当前主线默认是路径B（PC/树莓派网关），因为它**调试最舒服、闭环最稳**。  
路径A 的价值在于“更像真实产品”：设备侧自带联网与 TLS 能力，但学习成本更高。

## 什么时候进入路径A最划算？

满足任意一个条件就可以考虑：

- P0 已经闭环跑通（遥测入库 + 命令下发 + ACK）
- 你已经有 `[[P0_SPEC_v1]]` 的稳定协议/Topic，不想再改大结构
- 你想把“边缘网关”能力迁移到“设备自联网”，为海外投递增加可信度

## 路径A 的最小目标（不要上来就做满功能）

把 PC/树莓派网关做的事，搬到 ESP32 上（最小集合）：

1. UART 收帧/解帧（复用 P0 串口协议）
2. WiFi 连接与断线重连
3. MQTT publish telemetry / subscribe cmd / publish ack
4. 关键日志可观测（至少能看连接、重试、错误码）

## 与路径B的差异点（你会多踩的坑）

- WiFi 断线重连时序与退避策略（很容易“看似连上但不通”）
- MQTT/TLS（如果你加 TLS）会引入证书、时间、内存开销
- ESP-IDF 构建与调试链路更复杂（尤其是你同时维护 STM32 固件）

> 建议：先跑通“无 TLS 的 MQTT”，把业务闭环稳住，再决定是否上 TLS。
